{% load compress staticfiles bootstrap3 %}<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="keywords" content="">
        <meta name="description" content="">
        <meta name="author" content="">
        <!--<link rel="icon" href="favicon.ico">-->

        <title>{% block title %}Привет!{% endblock %} — {{ site_name }}</title>

        {% compress css %}
            <link rel="stylesheet" type="text/x-scss" href="{% static 'sass/app.scss' %}">
        {% endcompress %}
        {% block extra_head %}{% endblock %}
    </head>
    <body>
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{% url 'index' %}">{{ site_name }}</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                {% include 'main/_menu.html' %}
                {% include 'main/_menu_user.html' %}
            </div>
        </div>
    </nav>

<main class="container text-wrapped">
    {% block header %}
        <h3>{% block header-text %}{% endblock %}</h3>
    {% endblock %}
    {% bootstrap_messages %}
    {% block content %}{% endblock %}
</main>

        <footer class="container">
            <hr>
            <div class="row">
                <div class="col-xs-6">
                    2016 {{ site_name }}<br>
                    <a href="https://github.com/Davidyuk/witcoin/issues">Трекер ошибок</a>,
                    <a href="http://vk.com/witcoin">VK</a>
                </div>
                <div class="col-xs-6 text-right">
                    {% include 'main/_informer.html' %}
                </div>
            </div>
        </footer>
        {% compress js %}
            <script type="text/javascript" src="{% static 'jquery/dist/jquery.min.js' %}"></script>
            <script type="text/javascript" src="{% static 'bootstrap-sass/assets/javascripts/bootstrap.min.js' %}"></script>
            <script type="text/javascript" src="{% static 'js/app.js' %}"></script>
        {% endcompress %}
        <script type="text/javascript" src="{% static 'api.js' %}"></script>

        <script type="text/javascript">
            Witcoin.extendInit(function() {
                $('[data-vote]').each(function() {
                    var buttons = $('[data-up], [data-down], [data-clear]', this);
                    var action = $(this).data('action');
                    var id = $(this).data('id');
                    if (!action || !id) return;

                    var score = $('[data-score]', this);
                    function event(directon) {
                        return function() {
                            buttons.removeClass('disabled').removeAttr('disabled');
                            $(this).addClass('disabled').attr('disabled', 'disabled');
                            Witcoin.vote(action, id, directon).then(function(err, data) {
                                if (!err) {
                                    score.text(data.score.score);
                                } else {
                                    console.log(err, data);
                                }
                            });
                            return false;
                        }
                    }

                    $('[data-up]', this).on('click', event('up'));
                    $('[data-down]', this).on('click', event('down'));
                    $('[data-clear]', this).on('click', event('clear'));
                });
            });
        </script>

        <script>
            Witcoin.init();
        </script>
    {% block extra_script %}{% endblock %}
    </body>
</html>
